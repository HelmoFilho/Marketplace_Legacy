openapi: 3.0.0

info:
  title: "API do projeto B2B"
  description: "Documentação da API do projeto B2B 2.0."
  version: 0.2.0

servers:
  - url: 'https://wsmarketplace-dev.guarany.com.br/api/v1'
    description: Production server

tags:
  - name: "Listar Cliente-Usuario"
    description: "Lista as ligações cliente-usuario e cliente-distribuidor"

paths:
  
  /jmanager/colaboradores/clientes-marketplace/usuarios:
  
    post:
      tags:
        - "Listar Cliente-Usuario"
      summary: POST - Lista os cliente-usuario

      description: "
                      - Lista todos os usuario que possuem ligação a aos clientes \r\n
                        * Tabelas Consultadas: USUARIO, USUARIO_CLIENTE, CLIENTE, CLIENTE_DISTRIBUIDOR e DISTRIBUIDOR \r\n
                    "

      security:
        - ApiKeyAuth: []

      requestBody:
        description: "Request Body."
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Body-request'
            
            examples:
              Filtro do usuario:  # <--- Nome do Exemplo dado
                summary: Filtro do usuario correto
                value:
                  # vv Payload do exemplo vv
                  id_usuario: 0
                  id_distribuidor: 0
                  id_cliente: 0
                  status: 'A'
                  nome: "Jusiscleidon silva"
                  data_cadastro: ["1900-01-01", "3000-12-31"]
                  pagina: 1
                  limite: 20             
 
      responses:
        '200':
          description: "Sucesso na operação"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/Resposta_Tudo-ok'
              examples:
                
                Resposta_Tudo-ok:
                  summary: "Resposta: tudo ok"
                  value:
                    # vv Payload do exemplo vv
                    Descricao-detalhada:
                      descricao: "Caso a request ocorra sem nenhum problema."
                    Saida-Real:
                      status: 200
                      resposta: 
                        tipo: 1
                        descricao: Dados encontrados.
                      informacoes: 
                        itens: 0
                        paginas: 0
                        pagina_atual: 0
                      dados: [
                                {
                                    "id_cliente": 1,
                                    "status": "A",
                                    "cnpj": "06776387000159",
                                    "razao_social": "RAZÃO SOCIAL TESTE 1",
                                    "nome_fantasia": "NOME FANTASIA TESTE 1",
                                    "endereco": "ROD. 4º ANEL VIÁRIO",
                                    "endereco_num": "2161",
                                    "endereco_complemento": "",
                                    "bairro": "ANCURI",
                                    "cep": "60410342",
                                    "cidade": "FORTALEZA",
                                    "estado": "CE",
                                    "telefone": "31998003030",
                                    "data_cadastro": "2022-04-06",
                                    "data_aprovacao": "2022-04-06",
                                    "status_receita": "A",
                                    "usuarios": [
                                        {
                                            "id_usuario": 1,
                                            "nome": "HELMO FILHO",
                                            "cpf": "06783835375",
                                            "status": "A",
                                            "email": "JOSEHELMO@ASKTECHNOLOGY.COM.BR",
                                            "telefone": "85991347849",
                                            "data_cadastro": "2021-12-13",
                                            "status_usuario_cliente": "A"
                                        }
                                    ],
                                    "distribuidores": [
                                        {
                                            "id_distribuidor": 1,
                                            "nome_fantasia": "DAG DISTRIBUIDOR",
                                            "razao_social": "J SLEIMAN S.A. COMERCIO DE PRODUTOS DE HIGIENE E ALIMENTOS",
                                            "status_cliente_distribuidor": "A"
                                        }
                                    ]
                                }
                              ]
                
        '400':
          description: "Erro de sintaxe do usuário"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/Resposta_Dados-não-encontrados'
                  - $ref: '#/components/schemas/Resposta_Dados-invalidos'
                  - $ref: '#/components/schemas/Resposta_Dados-faltantes'
                  - $ref: '#/components/schemas/Resposta_Valores-invalidos'
                  - $ref: '#/components/schemas/Resposta_Valores-nulos'
              
              examples:

                Resposta_Dados-não-encontrados:
                  summary: "Resposta: Dados não encontrados"
                  value:
                    # vv Payload do exemplo vv
                    Descricao-detalhada:
                      descricao: "Caso a request ocorra mas não sejam encontrados os dados pedidos"
                    Saida-Real:
                      status: 400
                      resposta: 
                        tipo: 6
                        descricao: "Dados não encontrados para estes filtros."
                
                Resposta_Dados-invalidos:
                  summary: "Resposta: Dados inválidos"
                  value:
                    # vv Payload do exemplo vv
                    Descricao-detalhada:
                      descricao: "Para caso a request seja feita e alguma informação inválida (tag não-esperada) seja enviada."
                    Saida-Real:
                      status: 400
                      resposta: 
                        tipo: 2
                        descricao: "Lista com as chaves que são inválidas."

                Resposta_Dados-faltantes:
                  summary: "Resposta: Dados faltantes"
                  value:
                    # vv Payload do exemplo vv
                    Descricao-detalhada:
                      descricao: "Para caso a request seja feita e alguma tag obrigatoria não seja enviada."
                    Saida-Real:
                      status: 400
                      resposta: 
                        tipo: 3
                        descricao: "Lista com as chaves que estão faltando."

                Resposta_Valores-invalidos:
                  summary: "Resposta: Valores inválidos"
                  value:
                    # vv Payload do exemplo vv
                    Descricao-detalhada:
                      descricao: "Para caso a request seja feita e alguma tag obrigatoria esteja com valor do tipo diferente do esperado (string serve para todos)."
                    Saida-Real:
                      status: 400
                      resposta: 
                        tipo: 4
                        descricao: "Lista com as chaves que possuem valores do tipo incorretos."

                Resposta_Valores-nulos:
                  summary: "Resposta: Valores nulos"
                  value:
                    # vv Payload do exemplo vv
                    Descricao-detalhada:
                      descricao: "Para caso a request seja feita e alguma tag obrigatoria esteja com valor nulo."
                    Saida-Real:
                      status: 400
                      resposta: 
                        tipo: 14
                        descricao: "Lista com as chaves que possuem valores nulos"

        '401':
          description: "Usuário não-autenticado"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/Resposta_Token-invalido'
                  - $ref: '#/components/schemas/Resposta_Token-nao-enviado'

              examples:
                
                Resposta_Token-invalido:
                  summary: "Resposta: Token inválido"
                  value:
                    # vv Payload do exemplo vv
                    Descricao-detalhada:
                      descricao: "Caso o token seja enviado na request, ele será validado e, caso esteja inválido, será apagado e a sessão de login será encerrada."
                    Saida-Real:
                      status: 401
                      resposta: 
                        tipo: 11
                        descricao: "Token inválido."

                Resposta_Token-nao-enviado:
                  summary: "Resposta: Token não-enviado"
                  value:
                    # vv Payload do exemplo vv
                    Descricao-detalhada:
                      descricao: "Caso o token não seja enviado na request."
                    Saida-Real:
                      status: 401
                      resposta: 
                        tipo: 13
                        descricao: "Ação recusada: Token não enviado."

        '403':
          description: "Usuário sem autorização para acessar recurso"
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/Resposta_Permissao-insuficiente'
              
              examples:
                
                Resposta_Permissao-insuficiente:
                  summary: "Resposta: Permissão insuficiente"
                  value:
                    # vv Payload do exemplo vv
                    Descricao-detalhada:
                      descricao: "Caso o token seja enviado na request, ele seja validado mas o usuário não tenha permissão suficiente para realizar ação desejada."
                    Saida-Real:
                      status: 403
                      resposta: 
                        tipo: 12
                        descricao: "Usuário sem permissão para realizar ação"                 

components:

  # Esquemas envolvendo autenticação/autorização
  securitySchemes:

    ApiKeyAuth:
      type: apiKey
      in: header
      name: token
      description: >
                    - O envio do token é OBRIGATÓRIO. 

                    - O envio deve ser realizado no header da request.

                    - A permissão minima para acessar este endpoint é a de VISUALIZADOR.

                    - Neste Endpoint, o token utilizado será considerado inválido caso algum dos critérios abaixo seja atendido:
                        - Token não armazenado no banco de dados
                        - Token com estrutura inválida (3 elementos separados por 2 pontos)
                        - Token não criado pelo servidor (Erro no decode)
                        - Token Vencido
                        - Dados internos não batem
                        - Alterar_senha (tag do token) está ativo.
      
  schemas:

    # Response Body padrão
    Body-request:
      type: object
      properties:
        
        id_usuario:
          type: integer
          description: "ID do usuario."
        
        id_distribuidor: 
          type: integer
          description: "ID do distribuidor."
        
        id_cliente: 
          type: integer
          description: "ID do cliente."
        
        status: 
          type: string
          description: "Status do cliente."
          maxLength: 1
        
        busca: 
          type: string
          description: >
                          Busca por:
                            
                            * Razão social do cliente
                            * Nome fantasia do cliente
                            * CNPJ do cliente
                            * CPF do usuario
                            * E-mail do usuario
                            * Nome do usuario
        
        data_cadastro: 
          type: array
          description: "Holder das datas a serem utilizadas."
          items:
            type: string
            format: date
          maxItems: 2

        pagina:
          type: integer
          description: Pagina da paginação atual.
          minimum: 1
          default: 1

        limite:
          type: integer
          description: Quantidade de itens por página.
          minimum: 1
          default: 20

      example:

        id_usuario: 0
        id_distribuidor: 0
        id_cliente: 0
        status: 'A'
        busca: "Jusiscleidon silva"
        data_cadastro: ["1900-01-01", "3000-12-31"]
        pagina: 1
        limite: 20
 
    # Resposta para Tudo ok
    Resposta_Tudo-ok:
      type: object
      description: "Caso a request ocorra sem nenhum problema."

      properties:
        
          status:
            type: integer
            description: "Codigo HTTP da resposta enviada"
          
          resposta: 
            type: object
            description: "Utilizado para informar o tipo da resposta e uma descrição da mesma"
            properties:
          
              tipo: 
                type: string
                description: "Tipo da resposta apresentada"
          
              descricao:
                type: string
                description: "Mensagem descrevendo a situação da resposta"

          informacoes:
            type: object
            description: "Quarda informações sobre a paginação das informações."
            properties:

              itens:
                type: integer
                description: "Quantidade Máxima de informações a serem paginadas."

              paginas:
                type: integer
                description: "Quantidade Máxima de paginas disponiveis."

              pagina_atual:
                type: integer
                description: "Pagina atualmente da paginação."

          dados:
            type: array
            description: Lista com as informações do usuario
            items:
              
              type: object
              description: informações do usuario
      
      example:

        status: 200
        resposta: 
          tipo: 1
          descricao: Dados encontrados.
        informacoes: 
          itens: 0
          paginas: 0
          pagina_atual: 0
        dados: Holder dos dados encontrados

    # Resposta para Permissão insuficiente
    Resposta_Permissao-insuficiente:
      type: object
      description: Caso o token seja enviado na request, ele seja validado mas o usuário não tenha permissão suficiente para realizar ação desejada.
      properties:
        
        status:
          type: integer
          description: "Codigo HTTP da resposta enviada"
        
        resposta: 
          type: object
          description: "Utilizado para informar o tipo da resposta e uma descrição da mesma"
          properties:
        
            tipo: 
              type: string
              description: "Tipo da resposta apresentada"
        
            descricao:
              type: string
              description: "Mensagem descrevendo a situação da resposta"

      example:

        status: 401
        resposta: 
          tipo: 12
          descricao: "Usuário sem permissão para realizar ação"

    # Resposta para Token inválido
    Resposta_Token-invalido:
      type: object
      description: Caso o token seja enviado na request, ele será validado e, caso esteja inválido, será apagado e a sessão de login será encerrada.
      properties:
        
        status:
          type: integer
          description: "Codigo HTTP da resposta enviada"
        
        resposta: 
          type: object
          description: "Utilizado para informar o tipo da resposta e uma descrição da mesma"
          properties:
        
            tipo: 
              type: string
              description: "Tipo da resposta apresentada"
        
            descricao:
              type: string
              description: "Mensagem descrevendo a situação da resposta"

      example:

        status: 401
        resposta: 
          tipo: 11
          descricao: "Token inválido."

    # Resposta para Token inválido
    Resposta_Token-nao-enviado:
      type: object
      description: Caso o token não seja enviado na request.
      properties:
        
        status:
          type: integer
          description: "Codigo HTTP da resposta enviada"
        
        resposta: 
          type: object
          description: "Utilizado para informar o tipo da resposta e uma descrição da mesma"
          properties:
        
            tipo: 
              type: string
              description: "Tipo da resposta apresentada"
        
            descricao:
              type: string
              description: "Mensagem descrevendo a situação da resposta"

      example:

        status: 401
        resposta: 
          tipo: 13
          descricao: "Ação recusada: Token não enviado."

    # Resposta para Dados não encontrados
    Resposta_Dados-não-encontrados:
      type: object
      description: "Caso a request ocorra mas não sejam encontrados os dados pedidos"

      properties:
        
          status:
            type: integer
            description: "Codigo HTTP da resposta enviada"
          
          resposta: 
            type: object
            description: "Utilizado para informar o tipo da resposta e uma descrição da mesma"
            properties:
          
              tipo: 
                type: string
                description: "Tipo da resposta apresentada"
          
              descricao:
                type: string
                description: "Mensagem descrevendo a situação da resposta"
      
      example:

        status: 400
        resposta: 
          tipo: 6
          descricao: "Dados não encontrados para estes filtros."

    # Resposta para Dados inválidos
    Resposta_Dados-invalidos:
      type: object
      description: Para caso a request seja feita e alguma informação inválida (tag não-esperada) seja enviada.
      properties:
        
        status:
          type: integer
          description: "Codigo HTTP da resposta enviada"
        
        resposta: 
          type: object
          description: "Utilizado para informar o tipo da resposta e uma descrição da mesma"
          properties:
        
            tipo: 
              type: string
              description: "Tipo da resposta apresentada"
        
            descricao:
              type: string
              description: "Mensagem descrevendo a situação da resposta"

      example:

        status: 400
        resposta: 
          tipo: 2
          descricao: "Lista com as chaves que são inválidas"

    # Resposta para Dados faltantes
    Resposta_Dados-faltantes:
      type: object
      description: Para caso a request seja feita e alguma tag obrigatoria não seja enviada.
      properties:
        
        status:
          type: integer
          description: "Codigo HTTP da resposta enviada"
        
        resposta: 
          type: object
          description: "Utilizado para informar o tipo da resposta e uma descrição da mesma"
          properties:
        
            tipo: 
              type: string
              description: "Tipo da resposta apresentada"
        
            descricao:
              type: string
              description: "Mensagem descrevendo a situação da resposta"

      example:

        status: 400
        resposta: 
          tipo: 3
          descricao: "Lista com as chaves que estão faltando"

    # Resposta para Valores inválidos
    Resposta_Valores-invalidos:
      type: object
      description: Para caso a request seja feita e alguma tag obrigatoria esteja com valor do tipo diferente do esperado (string serve para todos).
      properties:
        
        status:
          type: integer
          description: "Codigo HTTP da resposta enviada"
        
        resposta: 
          type: object
          description: "Utilizado para informar o tipo da resposta e uma descrição da mesma"
          properties:
        
            tipo: 
              type: string
              description: "Tipo da resposta apresentada"
        
            descricao:
              type: string
              description: "Mensagem descrevendo a situação da resposta"

      example:

        status: 400
        resposta: 
          tipo: 4
          descricao: "Lista com as chaves que possuem valores do tipo incorretos"

    # Resposta para Valores nulos
    Resposta_Valores-nulos:
      type: object
      description: Para caso a request seja feita e alguma tag obrigatoria esteja com valor nulo.
      properties:
        
        status:
          type: integer
          description: "Codigo HTTP da resposta enviada"
        
        resposta: 
          type: object
          description: "Utilizado para informar o tipo da resposta e uma descrição da mesma"
          properties:
        
            tipo: 
              type: string
              description: "Tipo da resposta apresentada"
        
            descricao:
              type: string
              description: "Mensagem descrevendo a situação da resposta"

      example:

        status: 400
        resposta: 
          tipo: 14
          descricao: "Lista com as chaves que possuem valores nulos"